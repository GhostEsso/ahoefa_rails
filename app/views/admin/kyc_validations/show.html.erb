<div class="max-w-3xl mx-auto py-8">
  <div class="bg-white shadow overflow-hidden sm:rounded-lg">
    <div class="px-4 py-5 sm:px-6">
      <h3 class="text-lg leading-6 font-medium text-gray-900">
        Détails KYC - <%= @user.full_name %>
      </h3>
      <p class="mt-1 max-w-2xl text-sm text-gray-500">
        <% if @user.kyc_submitted_at.present? %>
          Soumis le <%= l @user.kyc_submitted_at, format: :long %>
        <% else %>
          Date de soumission non disponible
        <% end %>
      </p>
    </div>

    <div class="border-t border-gray-200 px-4 py-5 sm:px-6">
      <dl class="grid grid-cols-1 gap-x-4 gap-y-8 sm:grid-cols-2">
        <div class="sm:col-span-1">
          <dt class="text-sm font-medium text-gray-500">Email</dt>
          <dd class="mt-1 text-sm text-gray-900"><%= @user.email %></dd>
        </div>

        <div class="sm:col-span-1">
          <dt class="text-sm font-medium text-gray-500">Téléphone</dt>
          <dd class="mt-1 text-sm text-gray-900"><%= @user.phone_number %></dd>
        </div>

        <div class="sm:col-span-1">
          <dt class="text-sm font-medium text-gray-500">Plan</dt>
          <dd class="mt-1 text-sm text-gray-900"><%= @user.plan.capitalize %></dd>
        </div>

        <div class="sm:col-span-1">
          <dt class="text-sm font-medium text-gray-500">Statut</dt>
          <dd class="mt-1 text-sm">
            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full
              <%= case @user.kyc_status
                when 'pending' then 'bg-yellow-100 text-yellow-800'
                when 'approved' then 'bg-green-100 text-green-800'
                when 'rejected' then 'bg-red-100 text-red-800'
                end %>">
              <%= @user.kyc_status.capitalize %>
            </span>
          </dd>
        </div>

        <div class="sm:col-span-2">
          <dt class="text-sm font-medium text-gray-500 mb-4">Photo de profil</dt>
          <dd class="mt-1">
            <% if @user.avatar.attached? %>
              <div class="aspect-w-16 aspect-h-9">
                <%= image_tag @user.avatar, class: "object-cover rounded-lg shadow-lg" %>
              </div>
            <% else %>
              <p class="text-sm text-gray-500">Aucune photo de profil fournie</p>
            <% end %>
          </dd>
        </div>

        <div class="sm:col-span-2">
          <dt class="text-sm font-medium text-gray-500 mb-4">Carte d'identité</dt>
          <dd class="mt-1">
            <% if @user.identity_card.attached? %>
              <div class="aspect-w-16 aspect-h-9">
                <%= image_tag @user.identity_card, class: "object-cover rounded-lg shadow-lg" %>
              </div>
            <% else %>
              <p class="text-sm text-gray-500">Aucune carte d'identité fournie</p>
            <% end %>
          </dd>
        </div>

        <% if @user.kyc_rejected? %>
          <div class="sm:col-span-2">
            <dt class="text-sm font-medium text-gray-500">Motif du rejet</dt>
            <dd class="mt-1 text-sm text-red-600"><%= @user.kyc_rejection_reason %></dd>
          </div>
        <% end %>
      </dl>
    </div>

    <% if @user.kyc_pending? %>
      <div class="px-4 py-5 sm:px-6 bg-gray-50 flex justify-end space-x-3">
        <%= button_to approve_admin_kyc_validation_path(@user),
            method: :patch,
            class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700" do %>
          Approuver
        <% end %>

        <button data-modal-target="reject-<%= @user.id %>" 
                class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700">
          Rejeter
        </button>
      </div>

      <!-- Modal de rejet -->
      <div id="reject-<%= @user.id %>" class="hidden fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 max-w-md w-full">
          <h3 class="text-lg font-medium text-gray-900 mb-4">Motif du rejet</h3>
          <%= form_with(url: reject_admin_kyc_validation_path(@user), method: :patch) do |f| %>
            <div class="mb-4">
              <%= f.text_area :reason, rows: 4, 
                  class: "shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md",
                  placeholder: "Veuillez indiquer la raison du rejet..." %>
            </div>
            <div class="flex justify-end space-x-3">
              <button type="button" 
                      onclick="this.closest('[id^=reject-]').classList.add('hidden')"
                      class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
                Annuler
              </button>
              <%= f.submit "Confirmer le rejet",
                  class: "px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700" %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div> 